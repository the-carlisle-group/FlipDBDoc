<!DOCTYPE html><html lang="en">  <head>    <meta charset="utf-8"></meta>    <link href="/UserGuide.css" rel="stylesheet"></link>  </head>  <body>    <main>      <h1>Mortgage Cash Flows</h1>      <p>        FlipDB includes a set of functions for generating and analyzing        residential mortgage cash flows. The primary function is →[        <em>.mortgageCashFlow], which provides a wide range of inputs and        comprehensive set of outputs. In addition there is →[</em>        .mortgageCashFlowPrice], →[        <em>.mortgageCashFlowYield], and →[</em>        .mortgageCashFlowPresentValue], for computing prices, yields, and        present values respectively.      </p>      <p>The mortgageCashFlow function takes a property space as input,      and returns a property space as output. A simple example will make      this clear. Here is the Columns property of an ungrouped query for      loan level pricing:</p>      <table>        <thead>          <tr>            <th class="center">.</th>            <th class="center">Name</th>            <th class="center">Expression</th>          </tr>        </thead>        <tbody>          <tr>            <td class="center">1</td>            <td class="center">              <code>Input</code>            </td>            <td class="center">              <code>newPropertySpace 0</code>            </td>          </tr>          <tr>            <td class="center">2</td>            <td class="center">              <code>Input.Balance</code>            </td>            <td class="center">              <code>CurrentBalance</code>            </td>          </tr>          <tr>            <td class="center">3</td>            <td class="center">              <code>Input.Term</code>            </td>            <td class="center">              <code>MaturityDate monthsDifference AsOfDate</code>            </td>          </tr>          <tr>            <td class="center">4</td>            <td class="center">              <code>Input.Rate</code>            </td>            <td class="center">              <code>Rate</code>            </td>          </tr>          <tr>            <td class="center">5</td>            <td class="center">              <code>Input.ServiceFee</code>            </td>            <td class="center">              <code>.5</code>            </td>          </tr>          <tr>            <td class="center">6</td>            <td class="center">              <code>Input.StatedPrice</code>            </td>            <td class="center">              <code>97</code>            </td>          </tr>          <tr>            <td class="center">7</td>            <td class="center">              <code>Output</code>            </td>            <td class="center">              <code>mortgageCashFlow Input</code>            </td>          </tr>          <tr>            <td class="center">8</td>            <td class="center">              <code>CashFlow</code>            </td>            <td class="center">              <code>Output.CashFlow</code>            </td>          </tr>          <tr>            <td class="center">9</td>            <td class="center">              <code>ComputedYield</code>            </td>            <td class="center">              <code>3 round Output.ComputedYield</code>            </td>          </tr>          <tr>            <td class="center">10</td>            <td class="center">              <code>TotalInterest</code>            </td>            <td class="center">              <code>sum CashFlow.ScheduledInterest</code>            </td>          </tr>          <tr>            <td class="center">11</td>            <td class="center">              <code>ComputedYield2</code>            </td>            <td class="center">              <code>102 Input.Balance mortgageCashFlowYield CashFlow.CashFlow</code>            </td>          </tr>          <tr>            <td class="center">12</td>            <td class="center">              <code>PVofServicing</code>            </td>            <td class="center">              <code>4 mortgageCashFlowPresentValue (-CashFlow.ServiceFeeIncome)</code>            </td>          </tr>        </tbody>      </table>      <p>The first line establishes a new property space to collect the      inputs to the cash flow function.</p>      <p>The next five lines [2-6] define some inputs. An input may be      the name of a column, an expression, or a constatnt. There are over      30 named inputs, all which have default values so you only need to      specify the ones you want.</p>      <p>Once the desired inputs arguments are defined in the property      space, the mortgageCashFlow function is called on line 7, with the      property space as its argument.</p>      <p>The explicit result of the function is also a property space,      which contains all of the named outputs of the function. One of the      named outputs (CashFlow) is itself a property space. We pull this      up a level on line 8 to make it easier to access later. On line 9      we extract and round the ComputedYield output, to return it in the      query result.</p>      <p>On line 10 we extract and sum the ScheduledInterest output. Note      that aggregation is required as ScheduledInterest is a partioned      column - there is a list of monthly interest payments for each loan.</p>      <p>On line 11, we compute an additional yield for a different price.      The cashFlow function itself computes one yield based on the StatedPrice      input and the TotalCash output. However, the mortgageCashFlowYield      function allows computing multiple yields on any flows or functions      of those flows. Similar functionality exists for price given yield.</p>      <p>On line 12 we compute the present value of the service fee income      at 4%.'</p>      <p>For grouped queries the inputs must be aggregated, and potentially      rounded, and specified in the Measures property of the query. For      example:</p>      <p>        . | Name | Expression - | ------------- | ------------------ 1        |        <code>Input</code>        |        <code>newPropertySpace 0</code>        2 |        <code>Input.Balance</code>        |        <code>sum CurrentBalance</code>        3 |        <code>Input.Term</code>        |        <code>round average MaturityDate monthsDifference AsOfDate</code>        4 |        <code>Input.Rate</code>        |        <code>weightedAverage Rate CurrentBalance</code>        5 |        <code>CashFlow</code>        |        <code>mortgageCashFlow Input</code>        6 |        <code>ComputedYield</code>        |        <code>95 Input.Balance mortgageCashFlowYield CashFlow.TotalFlow</code>      </p>      <p>On line 1, a new property space is defined, as in the above example.      On line 2, however, we must sum the current balance column. Similarly      for lines 3 and 4, we must aggregate the inputs as the query is grouped,      and we are running cash flows on each group, not on each mortgage.</p>      <h2>Default, Missing, and Misspelled Inputs</h2>      <p>Note that no error is signaled when misspelling the name of an      input specified in the property space (or omiting it entirely). The      mortgageCashFlow function allows for additional names and values      to be in the input property space for informational purposes on reports.      Thus if you mistype, say, AmortizationTerm as AmortztonTerm, the      default value of 360 is used, and no error is reported.</p>      <p>There are many inputs, and virtually all them are optional and      have default values. Thus it is important to verify that the function      is in fact using the inputs you think you have specfied. The Excel      detail report will highlight the differences between inputs that      are specified, and inputs that are not specified and for which default      values are used.</p>      <h2>Time-Varying Inputs There are five "scenario" inputs to the cashflow      function for prepayment rates, default rates, loss severity, and      delinquency, and index. These inputs may be scalar, simple, enclosed,      or partitioned.</h2>      <p>These inputs must be adjusted for loan age upon or before assignment;      the mortageCashFlow function itself has no knowledge of age and makes      no adjustment for it.</p>      <h2>Andrew Davidson &amp; Company's LoanDynamics Model FlipDB provides      access to the LoanDynamics Model (LDM) from Andrew Davidson &amp;      Company (AD&amp;Co) through the →[*.loanDynamicsModel] function.      Outputs from LDM may then be used to specify inputs to the mortgageCashFlow      function. Outputs from LDM that are useful for inputs to mortgageCashFlow      include prepayment rate vectors, default rate vectors, and loss severity      vectors. You will need a licence (and key) from AD&amp;Co in order      to use this feature.</h2>      <p>FlipDB does not install any data files from AD&amp;Co. You must      have or create a folder that contains them. This folder may be named      and located as desired (you will need to specify this path later),      but it must contain the following subfolders and files:</p>      <p>        1.        <strong>DataFile</strong>      </p>      <p>This subfolder contains the LDM data files. AD&amp;Co updates      this monthly. It must also contain your license key file "adco_lic.key".</p>      <p>        1.        <strong>IO</strong>      </p>      <p>This folder is used for optional additional input and output.      It may be empty.</p>      <p>The loanDyamicsModel takes a property space as an argument. It      must include the minimum necessary LDM inputs:</p>      <p>        . | Name | Expression - | ------------- | ------------------ 1        |        <code>LDM</code>        |        <code>newPropertySpace 0</code>        2 |        <code>LDM.ADCOFolder</code>        |        <code>"c:ADCO"</code>        3 |        <code>LDM.FirstForecastYear</code>        |        <code>2016</code>        4 |        <code>LDM.FirstForecastMonth</code>        |        <code>9</code>        5 |        <code>LDM.WacIsFixed</code>        |        <code>1</code>        6 |        <code>LDM.Age</code>        |        <code>Age</code>        7 |        <code>LDM.RemainingTerm</code>        |        <code>RemTerm</code>        8 |        <code>LDM.OriginalTerm</code>        |        <code>OrigTerm</code>        9 |        <code>LDMOutput</code>        |        <code>loanDynamicsModel LDM</code>      </p>      <p>The output from the loanDyamicsModel function is also a property      space, containing all of the outputs provided by LDM. These outputs      are simply passed though as-is, with no transformations. To use them      as inputs for mortgageCashFlow they may need to be modified. For      example, below the LDM output MRR is converted to annual CPR, and      LossSeverity is converted to a percentage:</p>      <table>        <thead>          <tr>            <th class="center">.</th>            <th class="center">Name</th>            <th class="center">Expression</th>          </tr>        </thead>        <tbody>          <tr>            <td class="center">1</td>            <td class="center">              <code>I</code>            </td>            <td class="center">              <code>newPropertySpace 0</code>            </td>          </tr>          <tr>            <td class="center">2</td>            <td class="center">              <code>I.Balance</code>            </td>            <td class="center">              <code>CurrentBalance</code>            </td>          </tr>          <tr>            <td class="center">3</td>            <td class="center">              <code>I.Term</code>            </td>            <td class="center">              <code>RemTerm</code>            </td>          </tr>          <tr>            <td class="center">4</td>            <td class="center">              <code>I.Rate</code>            </td>            <td class="center">              <code>Rate</code>            </td>          </tr>          <tr>            <td class="center">5</td>            <td class="center">              <code>I.PrepaymentRateScenario</code>            </td>            <td class="center">              <code>smmToCPR LDMOutput.MRR</code>            </td>          </tr>          <tr>            <td class="center">6</td>            <td class="center">              <code>I.LossServerityScenario</code>            </td>            <td class="center">              <code>100 times LDMOutput.LossSeverity</code>            </td>          </tr>          <tr>            <td class="center">7</td>            <td class="center">              <code>I.LoanDynamicsOutput</code>            </td>            <td class="center">              <code>LDMOutput</code>            </td>          </tr>          <tr>            <td class="center">8</td>            <td class="center">              <code>CashFlow</code>            </td>            <td class="center">              <code>mortgageCashFlow I</code>            </td>          </tr>        </tbody>      </table>      <p>Note on line 7 that the entire LDM output property space is set      as an input to mortgageCashFlow. This does not affect the cashflow      model in any way; It ties the two models together only for displaying      data in the Excel detail spreadsheet.</p>      <p>The LoanDynamics model has many inputs, and the input names and      interpretations may be different when compared to the FlipDB cash      flow function and its inputs. These are entirely separate models,      and the inputs to each model are strictly separated.</p>      <p>For this reason, and for readability and flexibility, it is convenient      to put the LDM input specification into its own expression set and      to call it using →[*.evaluateExpressionSet].</p>      <p>Every value in the LDM input property space is assumed to be an      input to the LDM model, If a name is misspelled, or not an LDM input,      or an invalid value, an error is signalled.</p>      <p>Please refer to the AD&amp;Co documentation for details on the      inputs.</p>    </main>  </body></html>
